{# app/templates/pedagogie/_passeport_eval_form.html #}

<div class="card" style="margin:0; padding:0; border:none;">
  <form method="post"
        action="{{ url_for('pedagogie.participant_passeport_evaluation', participant_id=participant.id) }}?tab=evaluate">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <input type="hidden" name="secteur" value="{{ sec }}">

    <div class="grid" style="grid-template-columns:1.3fr 0.7fr; gap:12px;">
      <div>
        <label>Compétence</label>
        <select class="in" name="competence_id" required>
          <option value="">— Choisir une compétence —</option>
          {% for c in all_competences %}
            <option value="{{ c.id }}">{{ c.referentiel.nom if c.referentiel else 'Sans référentiel' }} · {{ c.code }} — {{ c.nom }}</option>
          {% endfor %}
        </select>
        <div class="muted" style="margin-top:6px;">Astuce : c’est la liste complète, donc ça peut être long. (On pourra ajouter une recherche ensuite.)</div>
      </div>

      <div>
        <label>Niveau</label>
        <select class="in" name="etat" required>
          <option value="0">0 — À faire / non évalué</option>
          <option value="1">1 — En cours</option>
          <option value="2">2 — Acquis</option>
          <option value="3">3 — Maîtrisé</option>
        </select>
      </div>
    </div>

    <div class="spacer"></div>

    <label>Commentaire (optionnel)</label>
    <input class="in" name="commentaire" placeholder="Observation rapide, difficulté, contexte…">

    <div class="spacer"></div>

    <label>Rattacher à une session (optionnel)</label>
    <select class="in" name="session_id">
      <option value="0">— Hors session —</option>
      {% for ss in session_choices %}
        {% set d = ss.date_session or ss.rdv_date or ss.created_at %}
        <option value="{{ ss.id }}">
          #{{ ss.id }} · {{ ss.nom if ss.nom else (ss.atelier.nom if ss.atelier else 'Session') }} · {{ d if d else '' }}
        </option>
      {% endfor %}
    </select>

    <div class="spacer"></div>

    <button class="btn ok" type="submit">Enregistrer l’évaluation</button>
  </form>
</div>